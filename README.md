
![screen](https://github.com/mdraven/terrafirmacraft_anvil/blob/master/screen.png)

Введение
--------

Дано: скриншот с кузнечной шкалой(зелёная и красная стрелка) и кузнечным паттерном(3 действия)

Нужно получить последовательность действий(я называю её цепью) для того чтобы красная стрелка
и зелёная стрелка оказались в одной позиции.

Есть следующие ограничения:
1. нельзя выходить за границы шкалы. На данный момент это отрезок [0; 150]. Я буду измерять его
   в очках(а расстояние на экране в пикселях);
2. цепь должна заканчиваться на кузнечный паттерн

Я точно не знаю про пропорции шкалы и экрана, но у меня при ширине скриншота равной 854, для того
чтобы перевести расстояние между зелёной и красной стрелкой в N пикселей в позицию на
шкале нужно поделить N на 2.

Поэтому нужно поставить зелёную стрелку в 0, замерить расстояние на скришоте в пикселях,
поделить это расстояние на 2 и получить величину T лежащую в [0; 150].

Разные техники двигают зелёную стрелку по разному, известны очки для разных техник:

    hit light: -3
    hit medium: -6
    hit heavy: -9
    draw: -15

    punch: 2
    bend: 7
    upset: 13
    shrink: 16

они были получены из исходного кода: https://github.com/Deadrik/TFCraft/blob/master/src/Common/com/bioxx/tfc/TileEntities/TEAnvil.java#L412

Первые 4 техники(красные) двигают зелёную стрелку влево, следующие 4(зелёные) вправо.


Идея
----

Идея заключается в следующем. Последние 3 действия заданные кузнечным паттерном нужно будет неминуемо сделать.
Это следует из условия.

Поэтому временно отбросим их подвинув стрелку в противоположную сторону от действия техники.
Мы можем сделать так потому что при выполнении цепи мы всё равно окажемся в этой позиции перед тем как
начнём выполнять паттерн.

Точка которую на которую мы сместились -- неоднозначная. Это связано с тем, что есть либеральные паттерны
которые позволяют выбрать разные удары молотом(это первые 3 красные техники) или вообще любое действие.
Но в кузнечном паттерне всего 3 ячейки, поэтому возможных комбинаций не будет больше чем 8^3 = 512.
Можно будет легко перебрать их всех и найти наиболее удачную.

Избавление от паттерна даст нам большое преимущество. Мы сможем хранить в памяти комбинации для 151
позиции на шкале, и не тратить память и процессорное время поиска на комбинации с паттернами.

Поиск цепочек делается с помощью обхода в ширину. Это позволит найти сразу самые короткие цепочки.
Мы будем брать все короткие цепочки для того, чтобы среди них можно было выбрать самые удобные для ввода.
Например цепочки aabb и abab имеют одинаковую длину, но первую вводить проще так как не надо тратить
время на смену кнопки. Но мы не можем выбрать самую удобную цепочку из-за того, что на её удобство
может повлиять кузнечный паттерн, а мы не учитываем его при поиске цепочки.

После того как мы нашли цепочки для определённого значения на шкале оставим среди них только те,
которые имеют наименьшее число смен техник. Т.е. из цепочек aabb, bbaa, abab, abba выкинем abab и abba.
Мы можем сделать так, потому что кузнечный паттерн не уменьшает число смен техник. Поэтому
если мы сейчас выкинем сложные для набора цепочки, то не потеряем лучшую цепочку.

Нижний абзац я решил не реализовывать из-за того, что есть опасность, что мы потеряем короткую цепочку.
Пример: aabbc, aabcc мы берём первую и тогда после добавления кузнечного паттерна последние 3 не сожмутся
в нажатие одной кнопки.

     Следующий шаг -- это оставить среди цепочек по одной на каждое последнее действие.
     Например среди цепочек abc, aac, abb, acb у нас есть две цепочки которые кончаются на действие 'c'
     и две цепочки на действие 'b'. Нужно оставить среди них одну цепочку так как состыковаться она сможет
     только с первым действием из кузнечного паттерна, а со вторым и третьем -- нет.
     Удобнее когда кнопки для задания действий идут по порядку, поэтому цепочка abb лучше чем acb.

     Если поиск в ширину написан таким образом, что он меняет элементы по порядку начиная с последнего
     (т.е. a, aa, ab, ac, ba, bb, bc, ca, ...), то цепочка у которой действия идут по порядку, и
     которая оканчивается на нужную технику -- это первая цепочка которая оканчивается на нужную технику.
     Например для 'c' -- это ac, для 'b' -- это ab.

     Если поиск в ширину меняет элементы начиная с первого(т.е. a, aa, ba, ca, ab, bb, cb, ac, ...), то
     нужная цепочка опять будет первой оканчивающейся на нужную технику.
